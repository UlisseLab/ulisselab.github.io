#! /bin/bash


readarray -t PRINTABLES < <( echo '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!"#$%&()+,-./:;<=>?@[\]^_`\{|\}~' |  fold -w1 )

FLAG=''
while [ "${FLAG: -1}" != '}' ]; do
	FLAG=$FLAG$(
		for C in ${PRINTABLES[@]} ; do
			INSTRUCTIONS=$(echo "$FLAG$C" | perf stat -x: -e instructions:u ./main 2>&1| grep instruction | cut -d: -f1)
			echo "$INSTRUCTIONS:$C"
		done | sort -n | head -n1 | cut -d: -f2 
	)
	echo $FLAG
done
